# 概念设计阶段的困难与取舍

| 困难 | 解决方案 |
| --- | --- |
| 递归关系的角色表达 | 采用连接实体 `UserDelegation`，以两条外键分别标注 `guardian`/`dependent` 角色，便于扩展权限元数据与多角色管理。 |
| Primary Care 唯一 | 使用条件唯一约束（同一用户 `isPrimaryCare=TRUE` 至多一条），并在应用层进行二次校验与冲突处理。 |
| 邀请的 15 天有效期 | 概念层以派生属性表示；实现层通过定时任务/生成列/触发器统一维护过期转态（`Expired`）与不可再接受规则。 |
| 月度汇总派生 | `stepsTotal` 由 `HealthMetric` 聚合得到；在物化视图与实时聚合之间权衡性能与数据新鲜度。 |
| 属性建模粒度 | 保持 `User.name` 为复合属性以支持国际化与检索；实现层可存储拆分字段（如 `firstName`/`lastName`）。 |
| 取消原因与状态枚举 | 采用“枚举 + 可选文本”折中设计，既保证统计一致性又保留描述灵活性。 |
| 邀请目标（邮箱/电话）可悬置 | 允许 `email/phone` 脱钩以支持未注册邀请；制定数据治理（归档/清理）策略以控制参照完整性与存量数据。 |
